(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[372],{41018:function(e,t,s){Promise.resolve().then(s.bind(s,31295))},31295:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return w}});var a=s(57437),l=s(2265),r=s(49322),n=s(65640),d=s(92934),i=s(17689),c=s(83774),o=s(71422),x=s(51817),m=s(12381),u=s(40279),h=s(23675),p=s(79820),f=s(69174),b=s(93448),g=s(9644),j=s(82566);let N={facebook:63206,instagram:2200,tiktok:2200,youtube:5e3,linkedin:3e3,google_business:2200};function v(e){let{onSuccess:t}=e,{activeBrandId:s,accounts:n}=(0,g.o)(),v=(0,l.useRef)(null),[y,k]=(0,l.useState)([]),[w,C]=(0,l.useState)({}),[S,P]=(0,l.useState)([]),[O,Z]=(0,l.useState)(""),[E,z]=(0,l.useState)(!1),[I,R]=(0,l.useState)(""),[T,_]=(0,l.useState)("09:00"),[L,A]=(0,l.useState)("draft"),[D,F]=(0,l.useState)(!1),[V,W]=(0,l.useState)(!1),[M,U]=(0,l.useState)(null),[B,G]=(0,l.useState)([]),J=n.map(e=>e.platform).filter((e,t,s)=>s.indexOf(e)===t),Y=()=>y.some(e=>(D?w[e]||"":w[y[0]]||"").length>N[e]),q=e=>{k(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},H=e=>{D?C(t=>({...t,[y[0]]:e})):C(t=>({...t,[y[0]]:e}))},K=e=>{e&&Array.from(e).forEach(e=>{if(!e.type.startsWith("image/")&&!e.type.startsWith("video/")){U({type:"error",text:"Only image and video files are supported"});return}let t=URL.createObjectURL(e);G(e=>[...e,t]),P(e=>[...e,t])})},Q=e=>{G(t=>t.filter((t,s)=>s!==e)),P(t=>t.filter((t,s)=>s!==e))},X=async()=>{if(!s||0===y.length){U({type:"error",text:"Select platforms to publish to"});return}let e=w[y[0]]||"";if(!e.trim()){U({type:"error",text:"Add content to your post"});return}if(Y()){U({type:"error",text:"Content exceeds character limit for selected platform(s)"});return}W(!0),U(null);try{let a=D?{...w}:y.reduce((t,s)=>(t[s]=e,t),{}),l="draft",r=null;"publish"===L?l="published":"scheduled"===L&&(l="scheduled",r="".concat(I,"T").concat(T,":00"));let n=await fetch("/api/posts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({brandId:s,content:a,mediaUrls:S,platforms:y,status:l,scheduledFor:r,location:O||null})});if(!n.ok){let e=await n.json();throw Error(e.error||"Failed to create post")}U({type:"success",text:"publish"===L?"Post published successfully!":"scheduled"===L?"Post scheduled successfully!":"Post saved as draft!"}),k([]),C({}),P([]),G([]),Z(""),z(!1),R(""),_("09:00"),A("draft"),F(!1),null==t||t()}catch(e){U({type:"error",text:e instanceof Error?e.message:"Failed to create post"})}finally{W(!1)}},$=w[y[0]]||"";return(0,a.jsxs)(p.Zb,{className:"bg-white dark:bg-slate-950",children:[(0,a.jsx)(p.Ol,{children:(0,a.jsx)(p.ll,{children:"Compose Post"})}),(0,a.jsxs)(p.aY,{className:"space-y-6",children:[M&&(0,a.jsxs)("div",{className:(0,b.cn)("flex items-center gap-3 p-4 rounded-lg","success"===M.type?"bg-green-50 dark:bg-green-950 text-green-700 dark:text-green-300":"bg-red-50 dark:bg-red-950 text-red-700 dark:text-red-300"),children:["success"===M.type?(0,a.jsx)(d.Z,{className:"h-5 w-5 flex-shrink-0"}):(0,a.jsx)(r.Z,{className:"h-5 w-5 flex-shrink-0"}),(0,a.jsx)("p",{className:"text-sm font-medium",children:M.text})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-900 dark:text-slate-50",children:"Select Platforms"}),0===J.length?(0,a.jsx)("div",{className:"rounded-lg border-2 border-dashed border-slate-300 dark:border-slate-700 p-6 text-center",children:(0,a.jsx)("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"No connected platforms. Go to brand settings to connect your social accounts."})}):(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:j.VT.filter(e=>J.includes(e.id)).map(e=>{let t=y.includes(e.id);return(0,a.jsx)("button",{onClick:()=>q(e.id),className:(0,b.cn)("flex items-center justify-center gap-2 rounded-lg border-2 px-4 py-2.5 transition-all",t?"border-brand-500 bg-brand-50 dark:bg-brand-950 text-brand-700 dark:text-brand-300":"border-slate-200 dark:border-slate-800 hover:border-slate-300 dark:hover:border-slate-700"),children:(0,a.jsx)("span",{className:"text-sm font-medium",children:e.label})},e.id)})})]}),y.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg bg-slate-50 dark:bg-slate-900",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-slate-900 dark:text-slate-50",children:"Customize per platform"}),(0,a.jsx)("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:"Different content for each platform"})]}),(0,a.jsx)("button",{type:"button",onClick:()=>F(!D),className:(0,b.cn)("relative w-11 h-6 rounded-full transition-colors",D?"bg-brand-500":"bg-slate-200 dark:bg-slate-700"),children:(0,a.jsx)("div",{className:(0,b.cn)("absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full transition-transform",D&&"translate-x-5")})})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-900 dark:text-slate-50",children:"Content"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("span",{className:"text-xs text-slate-600 dark:text-slate-400",children:[$.length," /"," ",N[y[0]]]}),$.length>N[y[0]]&&(0,a.jsx)(f.C,{variant:"destructive",children:"Over limit"})]})]}),(0,a.jsx)(h.g,{placeholder:"What's on your mind?",value:$,onChange:e=>H(e.target.value),className:"min-h-32 resize-none",maxLength:Math.max(...y.map(e=>N[e]))})]}),D&&y.length>1&&(0,a.jsxs)("div",{className:"space-y-3 pt-3 border-t border-slate-200 dark:border-slate-800",children:[(0,a.jsx)("p",{className:"text-xs font-medium text-slate-600 dark:text-slate-400",children:"Platform-specific content preview"}),(0,a.jsx)("div",{className:"grid gap-3",children:y.map(e=>{var t;return(0,a.jsxs)("div",{className:"space-y-1 p-2 rounded-lg bg-slate-50 dark:bg-slate-900",children:[(0,a.jsx)("p",{className:"text-xs font-medium text-slate-700 dark:text-slate-300",children:null===(t=j.VT.find(t=>t.id===e))||void 0===t?void 0:t.label}),(0,a.jsx)("p",{className:"text-xs text-slate-600 dark:text-slate-400 line-clamp-2",children:w[e]||"(Same as default)"})]},e)})})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-900 dark:text-slate-50",children:"Media (Images & Videos)"}),(0,a.jsxs)("div",{className:"rounded-lg border-2 border-dashed border-slate-300 dark:border-slate-700 p-4",children:[(0,a.jsx)("input",{ref:v,type:"file",multiple:!0,accept:"image/*,video/*",onChange:e=>K(e.target.files),className:"hidden"}),(0,a.jsxs)("button",{type:"button",onClick:()=>{var e;return null===(e=v.current)||void 0===e?void 0:e.click()},className:"w-full flex items-center justify-center gap-2 py-6 hover:bg-slate-50 dark:hover:bg-slate-900 transition-colors",children:[(0,a.jsx)(i.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Click to upload or drag files"})]})]}),B.length>0&&(0,a.jsx)("div",{className:"grid grid-cols-3 gap-2",children:B.map((e,t)=>(0,a.jsxs)("div",{className:"relative group",children:[(0,a.jsx)("img",{src:e,alt:"Preview ".concat(t+1),className:"w-full h-20 object-cover rounded-lg"}),(0,a.jsx)("button",{type:"button",onClick:()=>Q(t),className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 flex items-center justify-center rounded-lg transition-opacity",children:(0,a.jsx)("span",{className:"text-white text-sm font-medium",children:"Remove"})})]},t))})]}),(0,a.jsxs)("div",{className:"grid gap-3 pt-3 border-t border-slate-200 dark:border-slate-800",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-900 dark:text-slate-50",children:"Location (Optional)"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(c.Z,{className:"h-4 w-4 text-slate-400"}),(0,a.jsx)(u.I,{placeholder:"Add location",value:O,onChange:e=>Z(e.target.value),className:"flex-1"})]})]}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsxs)(m.z,{type:"button",variant:"ghost",size:"sm",className:"gap-2",title:"Emoji picker (placeholder)",children:[(0,a.jsx)(o.Z,{className:"h-4 w-4"}),"Emoji"]})})]}),E&&(0,a.jsx)("div",{className:"space-y-3 p-4 rounded-lg bg-slate-50 dark:bg-slate-900",children:(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-900 dark:text-slate-50",children:"Date"}),(0,a.jsx)(u.I,{type:"date",value:I,onChange:e=>R(e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-900 dark:text-slate-50",children:"Time"}),(0,a.jsx)(u.I,{type:"time",value:T,onChange:e=>_(e.target.value)})]})]})}),(0,a.jsx)("div",{className:"flex flex-col gap-3 pt-3 border-t border-slate-200 dark:border-slate-800",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(m.z,{onClick:()=>{A("draft"),X()},variant:"secondary",disabled:V||0===y.length,className:"flex-1 gap-2",children:[V&&"draft"===L&&(0,a.jsx)(x.Z,{className:"h-4 w-4 animate-spin"}),"Save Draft"]}),(0,a.jsxs)(m.z,{onClick:()=>{A("scheduled"),E?X():z(!0)},variant:"outline",disabled:V||0===y.length,className:"gap-2",children:[V&&"scheduled"===L&&(0,a.jsx)(x.Z,{className:"h-4 w-4 animate-spin"}),"Schedule"]}),(0,a.jsxs)(m.z,{onClick:()=>{A("publish"),X()},disabled:V||0===y.length||Y(),className:"flex-1 gap-2",children:[V&&"publish"===L&&(0,a.jsx)(x.Z,{className:"h-4 w-4 animate-spin"}),"Post Now"]})]})})]})]})]})}var y=s(31444),k=s(99376);function w(){let{activeBrandId:e,getActiveBrand:t}=(0,g.o)(),s=(0,k.useRouter)(),[d,i]=(0,l.useState)(0),c=t();return((0,l.useEffect)(()=>{e||s.push("/dashboard")},[e,s]),e)?(0,a.jsx)(n.r,{title:"Planner",subtitle:(null==c?void 0:c.name)?"Create content for ".concat(c.name):"Create and schedule content",children:(0,a.jsx)("div",{className:"space-y-6 p-6",children:(0,a.jsxs)("div",{className:"grid gap-6 lg:grid-cols-3",children:[(0,a.jsx)("div",{className:"lg:col-span-2",children:(0,a.jsx)(v,{onSuccess:()=>{i(e=>e+1)}})}),(0,a.jsx)("div",{className:"lg:col-span-1",children:(0,a.jsx)("div",{className:"sticky top-20",children:(0,a.jsx)(y.p,{},d)})})]})})}):(0,a.jsx)(n.r,{title:"Planner",subtitle:"Create and schedule content",children:(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[60vh] p-6",children:(0,a.jsxs)("div",{className:"text-center space-y-4",children:[(0,a.jsx)(r.Z,{className:"h-12 w-12 mx-auto text-amber-600 dark:text-amber-400"}),(0,a.jsx)("h2",{className:"text-lg font-semibold text-slate-900 dark:text-slate-50",children:"No Brand Selected"}),(0,a.jsx)("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Please select a brand to start planning content"})]})})})}},40279:function(e,t,s){"use strict";s.d(t,{I:function(){return n}});var a=s(57437),l=s(2265),r=s(93448);let n=l.forwardRef((e,t)=>{let{className:s,type:l,...n}=e;return(0,a.jsx)("input",{type:l,className:(0,r.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-500 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...n})});n.displayName="Input"},23675:function(e,t,s){"use strict";s.d(t,{g:function(){return n}});var a=s(57437),l=s(2265),r=s(93448);let n=l.forwardRef((e,t)=>{let{className:s,...l}=e;return(0,a.jsx)("textarea",{className:(0,r.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-500 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...l})});n.displayName="Textarea"}},function(e){e.O(0,[569,648,221,640,444,971,117,744],function(){return e(e.s=41018)}),_N_E=e.O()}]);