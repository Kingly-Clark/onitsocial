"use strict";(()=>{var e={};e.id=1567,e.ids=[1567],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3986:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>g,requestAsyncStorage:()=>p,routeModule:()=>u,serverHooks:()=>m,staticGenerationAsyncStorage:()=>d});var s={};r.r(s),r.d(s,{GET:()=>l});var a=r(9303),n=r(8716),o=r(670),c=r(7070),i=r(5655);async function l(e){try{let t=await (0,i.f)(),{data:{user:r},error:s}=await t.auth.getUser();if(s||!r)return c.NextResponse.json({error:"Unauthorized"},{status:401});let a=e.nextUrl.searchParams,n=a.get("brand_id"),o=a.get("from"),l=a.get("to"),u=a.get("platform");if(!n)return c.NextResponse.json({error:"brand_id is required"},{status:400});let{data:p,error:d}=await t.from("brands").select("id").eq("id",n).eq("user_id",r.id).single();if(d||!p)return c.NextResponse.json({error:"Brand not found"},{status:404});let m=t.from("analytics_cache").select(`
        *,
        connected_accounts(platform, platform_username)
      `).eq("connected_accounts.brand_id",n);o&&(m=m.gte("date",o)),l&&(m=m.lte("date",l)),u&&(m=m.eq("connected_accounts.platform",u)),m=m.order("date",{ascending:!0});let{data:f,error:g}=await m;if(g)return console.error("Analytics query error:",g),c.NextResponse.json({error:"Failed to fetch analytics"},{status:500});let h=0,_=0,x=0,v=0,y=0,w={};f.forEach(e=>{if(h+=e.followers,_+=e.impressions,x+=e.reach,v+=e.engagement,y+=e.clicks,e.connected_accounts?.platform){let t=e.connected_accounts.platform;w[t]||(w[t]={platform:t,followers:0,impressions:0,reach:0,engagement:0,clicks:0}),w[t].followers+=e.followers,w[t].impressions+=e.impressions,w[t].reach+=e.reach,w[t].engagement+=e.engagement,w[t].clicks+=e.clicks}});let E={};f.forEach(e=>{let t=`${e.date}`;E[t]||(E[t]={date:e.date,followers:0,impressions:0,reach:0,engagement:0,clicks:0,platform:e.connected_accounts?.platform||null}),E[t].followers+=e.followers,E[t].impressions+=e.impressions,E[t].reach+=e.reach,E[t].engagement+=e.engagement,E[t].clicks+=e.clicks});let k=Object.values(E);return c.NextResponse.json({dailyData:k,totals:{followers:h,impressions:_,reach:x,engagement:v,clicks:y},platformBreakdown:Object.values(w),status:200},{status:200})}catch(e){return console.error("GET /api/analytics error:",e),c.NextResponse.json({error:"Internal server error"},{status:500})}}let u=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/analytics/route",pathname:"/api/analytics",filename:"route",bundlePath:"app/api/analytics/route"},resolvedPagePath:"/Users/tezferguson/gitProjects/onitsocial/src/app/api/analytics/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:p,staticGenerationAsyncStorage:d,serverHooks:m}=u,f="/api/analytics/route";function g(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:d})}},5655:(e,t,r)=>{r.d(t,{f:()=>n,k:()=>o});var s=r(7721),a=r(1615);async function n(){let e=await (0,a.cookies)();return(0,s.createServerClient)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,{cookies:{get:t=>e.get(t)?.value,set(t,r,s){try{e.set({name:t,value:r,...s})}catch{}},remove(t,r){try{e.set({name:t,value:"",...r})}catch{}}}})}async function o(){let{createClient:e}=await Promise.resolve().then(r.bind(r,7857));return e(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[9276,9702,5972],()=>r(3986));module.exports=s})();