"use strict";(()=>{var e={};e.id=9602,e.ids=[9602],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5981:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>E,patchFetch:()=>x,requestAsyncStorage:()=>h,routeModule:()=>f,serverHooks:()=>_,staticGenerationAsyncStorage:()=>m});var s={};r.r(s),r.d(s,{DELETE:()=>p,GET:()=>d,PATCH:()=>l});var o=r(9303),a=r(8716),n=r(670),i=r(7070),u=r(5655),c=r(8656);async function d(e,{params:t}){try{let e=await (0,u.f)(),{data:{user:r},error:s}=await e.auth.getUser();if(s||!r)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{id:o}=await t,{data:a,error:n}=await e.from("posts").select("*").eq("id",o).eq("user_id",r.id).single();if(n||!a)return i.NextResponse.json({error:"Post not found"},{status:404});return i.NextResponse.json({data:a,status:200})}catch(e){return console.error("GET /api/posts/[id] error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function l(e,{params:t}){try{let r=await (0,u.f)(),{data:{user:s},error:o}=await r.auth.getUser();if(o||!s)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{id:a}=await t,{content:n,platforms:d,scheduledFor:l,status:p}=await e.json(),{data:f,error:h}=await r.from("posts").select("*").eq("id",a).eq("user_id",s.id).single();if(h||!f)return i.NextResponse.json({error:"Post not found"},{status:404});if(l){let e=new Date(l),t=new Date,r=new Date;if(r.setMonth(r.getMonth()+2),e<t)return i.NextResponse.json({error:"scheduledFor must be in the future"},{status:400});if(e>r)return i.NextResponse.json({error:"scheduledFor must be within 2 months"},{status:400})}let m={};if(void 0!==n&&(m.content=n),void 0!==d&&(m.platforms=d),void 0!==l&&(m.scheduled_for=l),void 0!==p&&(m.status=p),"published"===p&&"published"!==f.status&&null===f.late_profile_id){let{data:e,error:t}=await r.from("brands").select("late_profile_id").eq("id",f.brand_id).single();if(!t&&e?.late_profile_id)try{let t=n||f.content,r=d||f.platforms,s=t[r[0]]||t[Object.keys(t)[0]]||"",o=await (0,c.qb)({profileId:e.late_profile_id,text:s,mediaUrls:f.media_urls,platforms:r,publishNow:!0});m.late_post_id=o.id}catch(e){console.error("Failed to create post on getlate.dev:",e)}}let{data:_,error:E}=await r.from("posts").update(m).eq("id",a).select().single();if(E)return console.error("Database update error:",E),i.NextResponse.json({error:"Failed to update post"},{status:500});return i.NextResponse.json({data:_,status:200})}catch(e){return console.error("PATCH /api/posts/[id] error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function p(e,{params:t}){try{let e=await (0,u.f)(),{data:{user:r},error:s}=await e.auth.getUser();if(s||!r)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{id:o}=await t,{data:a,error:n}=await e.from("posts").select("*").eq("id",o).eq("user_id",r.id).single();if(n||!a)return i.NextResponse.json({error:"Post not found"},{status:404});if(a.late_post_id)try{await (0,c.fR)(a.late_post_id)}catch(e){console.error("Failed to delete post on getlate.dev:",e)}let{error:d}=await e.from("posts").delete().eq("id",o);if(d)return i.NextResponse.json({error:"Failed to delete post"},{status:500});return i.NextResponse.json({data:{id:o},status:200},{status:200})}catch(e){return console.error("DELETE /api/posts/[id] error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}let f=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/posts/[id]/route",pathname:"/api/posts/[id]",filename:"route",bundlePath:"app/api/posts/[id]/route"},resolvedPagePath:"/Users/tezferguson/gitProjects/onitsocial/src/app/api/posts/[id]/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:m,serverHooks:_}=f,E="/api/posts/[id]/route";function x(){return(0,n.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:m})}},8656:(e,t,r)=>{r.d(t,{AM:()=>c,ED:()=>i,HH:()=>_,_U:()=>m,bP:()=>d,fR:()=>f,he:()=>u,mb:()=>h,qb:()=>p,tm:()=>l});let s=process.env.LATE_API_BASE_URL||"https://getlate.dev/api/v1",o=process.env.LATE_API_KEY||"";class a extends Error{constructor(e,t,r){super(t),this.statusCode=e,this.responseBody=r,this.name="LateApiError"}}async function n(e,t={}){let{method:r="GET",body:n,params:i}=t,u=`${s}${e}`;if(i){let e=new URLSearchParams(i);u+=`?${e.toString()}`}let c={Authorization:`Bearer ${o}`,"Content-Type":"application/json"},d=await fetch(u,{method:r,headers:c,body:n?JSON.stringify(n):void 0});if(!d.ok){let e=await d.json().catch(()=>null);throw new a(d.status,`Late API error: ${d.status} ${d.statusText}`,e)}if(204!==d.status)return d.json()}async function i(e){let t=await n("/profiles",{method:"POST",body:{name:e}});return{id:t.profile._id,name:t.profile.name}}async function u(e){return n(`/profiles/${e}`,{method:"DELETE"})}async function c(e,t,r){let s=await n(`/connect/${e}`,{params:{profileId:t,redirect_url:r,headless:"true"}}),o=s.url||s.connectUrl||s.authUrl;if(!o)throw console.error("Unexpected getLate connect response:",s),Error("No connect URL in response");return{url:o}}async function d(e){let t=await n("/accounts",{params:{profileId:e}});return t.accounts?{data:t.accounts.map(e=>({id:e._id||e.id,platform:e.platform,username:e.username||e.name||"",avatarUrl:e.avatarUrl||""}))}:{data:t.data||[]}}async function l(e){return n(`/accounts/${e}`,{method:"DELETE"})}async function p(e){return n("/posts",{method:"POST",body:e})}async function f(e){return n(`/posts/${e}`,{method:"DELETE"})}async function h(e,t,r){return n(`/analytics/${e}`,{params:{startDate:t,endDate:r}})}async function m(e,t){let r={profileId:e};return t&&(r.cursor=t),n("/messages",{params:r})}async function _(e,t){return n(`/messages/${e}/reply`,{method:"POST",body:{text:t}})}},5655:(e,t,r)=>{r.d(t,{f:()=>a,k:()=>n});var s=r(7721),o=r(1615);async function a(){let e=await (0,o.cookies)();return(0,s.createServerClient)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,{cookies:{get:t=>e.get(t)?.value,set(t,r,s){try{e.set({name:t,value:r,...s})}catch{}},remove(t,r){try{e.set({name:t,value:"",...r})}catch{}}}})}async function n(){let{createClient:e}=await Promise.resolve().then(r.bind(r,7857));return e(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[9276,9702,5972],()=>r(5981));module.exports=s})();