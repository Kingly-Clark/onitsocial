"use strict";(()=>{var e={};e.id=5348,e.ids=[5348],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},37756:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>y,requestAsyncStorage:()=>f,routeModule:()=>p,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m});var n={};r.r(n),r.d(n,{POST:()=>d});var o=r(49303),s=r(88716),a=r(60670),i=r(87070),c=r(65655),u=r(8656);let l=r(57108).VT.map(e=>e.id);async function d(e){try{let t;let r=await (0,c.f)(),{data:{user:n},error:o}=await r.auth.getUser();if(o||!n)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{brandId:s,platform:a}=await e.json();if(!s||"string"!=typeof s)return i.NextResponse.json({error:"Brand ID is required"},{status:400});if(!a||!l.includes(a))return i.NextResponse.json({error:"Invalid platform"},{status:400});let{data:d,error:p}=await r.from("brands").select("id, late_profile_id").eq("id",s).eq("user_id",n.id).single();if(p||!d)return i.NextResponse.json({error:"Brand not found"},{status:404});if(!d.late_profile_id)return i.NextResponse.json({error:"Brand has not been synced with platform"},{status:400});let f=process.env.NEXT_PUBLIC_APP_URL||"http://localhost:3000",m=`${f}/connections/callback`;try{t=await (0,u.AM)(a,d.late_profile_id,m)}catch(t){console.error("getLate connect error:",t);let e="Failed to get connect URL from platform";if(t&&"object"==typeof t){if("statusCode"in t){let r=t.responseBody;e=`Platform error (${t.statusCode}): ${r?.message||r?.error||JSON.stringify(r)}`}else"message"in t&&(e=String(t.message))}return i.NextResponse.json({error:e},{status:500})}return i.NextResponse.json({data:{url:t.url},status:200})}catch(e){return console.error("POST /api/connections error:",e),i.NextResponse.json({error:e instanceof Error?e.message:"Internal server error"},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/connections/route",pathname:"/api/connections",filename:"route",bundlePath:"app/api/connections/route"},resolvedPagePath:"/Users/tezferguson/gitProjects/onitsocial/src/app/api/connections/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:f,staticGenerationAsyncStorage:m,serverHooks:h}=p,g="/api/connections/route";function y(){return(0,a.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},8656:(e,t,r)=>{r.d(t,{AM:()=>u,ED:()=>i,HH:()=>g,_U:()=>h,bP:()=>l,fR:()=>f,he:()=>c,mb:()=>m,qb:()=>p,tm:()=>d});let n=process.env.LATE_API_BASE_URL||"https://getlate.dev/api/v1",o=process.env.LATE_API_KEY||"";class s extends Error{constructor(e,t,r){super(t),this.statusCode=e,this.responseBody=r,this.name="LateApiError"}}async function a(e,t={}){let{method:r="GET",body:a,params:i}=t,c=`${n}${e}`;if(i){let e=new URLSearchParams(i);c+=`?${e.toString()}`}let u={Authorization:`Bearer ${o}`,"Content-Type":"application/json"},l=await fetch(c,{method:r,headers:u,body:a?JSON.stringify(a):void 0});if(!l.ok){let e=await l.json().catch(()=>null);throw new s(l.status,`Late API error: ${l.status} ${l.statusText}`,e)}if(204!==l.status)return l.json()}async function i(e){let t=await a("/profiles",{method:"POST",body:{name:e}});return{id:t.profile._id,name:t.profile.name}}async function c(e){return a(`/profiles/${e}`,{method:"DELETE"})}async function u(e,t,r){let n=await a(`/connect/${e}`,{params:{profileId:t,redirect_url:r,headless:"true"}}),o=n.url||n.connectUrl||n.authUrl;if(!o)throw console.error("Unexpected getLate connect response:",n),Error("No connect URL in response");return{url:o}}async function l(e){let t=await a("/accounts",{params:{profileId:e}});return t.accounts?{data:t.accounts.map(e=>({id:e._id||e.id,platform:e.platform,username:e.username||e.name||"",avatarUrl:e.avatarUrl||""}))}:{data:t.data||[]}}async function d(e){return a(`/accounts/${e}`,{method:"DELETE"})}async function p(e){return a("/posts",{method:"POST",body:e})}async function f(e){return a(`/posts/${e}`,{method:"DELETE"})}async function m(e,t,r){return a(`/analytics/${e}`,{params:{startDate:t,endDate:r}})}async function h(e,t){let r={profileId:e};return t&&(r.cursor=t),a("/messages",{params:r})}async function g(e,t){return a(`/messages/${e}/reply`,{method:"POST",body:{text:t}})}},65655:(e,t,r)=>{r.d(t,{f:()=>s,k:()=>a});var n=r(67721),o=r(71615);async function s(){let e=await (0,o.cookies)();return(0,n.createServerClient)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,{cookies:{get:t=>e.get(t)?.value,set(t,r,n){try{e.set({name:t,value:r,...n})}catch{}},remove(t,r){try{e.set({name:t,value:"",...r})}catch{}}}})}async function a(){let{createClient:e}=await Promise.resolve().then(r.bind(r,37857));return e(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})}},57108:(e,t,r)=>{r.d(t,{VT:()=>o,an:()=>n});let n={solo:1,starter:5,advanced:10},o=[{id:"facebook",label:"Facebook",color:"#1877F2",icon:"Facebook"},{id:"instagram",label:"Instagram",color:"#E4405F",icon:"Instagram"},{id:"tiktok",label:"TikTok",color:"#000000",icon:"Music"},{id:"youtube",label:"YouTube",color:"#FF0000",icon:"Youtube"},{id:"linkedin",label:"LinkedIn",color:"#0A66C2",icon:"Linkedin"},{id:"google_business",label:"Google Business",color:"#4285F4",icon:"MapPin"}]}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[9276,9702,5972],()=>r(37756));module.exports=n})();