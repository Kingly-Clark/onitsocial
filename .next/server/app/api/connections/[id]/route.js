"use strict";(()=>{var e={};e.id=6024,e.ids=[6024],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6182:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>h,patchFetch:()=>m,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>E,staticGenerationAsyncStorage:()=>f});var r={};n.r(r),n.d(r,{DELETE:()=>d});var s=n(9303),o=n(8716),a=n(670),c=n(7070),i=n(5655),u=n(8656);async function d(e,{params:t}){try{let{id:e}=await t,n=await (0,i.f)(),{data:{user:r},error:s}=await n.auth.getUser();if(s||!r)return c.NextResponse.json({error:"Unauthorized"},{status:401});let{data:o,error:a}=await n.from("connected_accounts").select(`
        id,
        brand_id,
        late_account_id,
        brands (
          id,
          user_id
        )
      `).eq("id",e).single();if(a||!o)return c.NextResponse.json({error:"Account not found"},{status:404});if(o.brands.user_id!==r.id)return c.NextResponse.json({error:"Unauthorized"},{status:403});if(o.late_account_id)try{await (0,u.tm)(o.late_account_id)}catch(e){console.error("Failed to delete Late account:",e)}let{error:d}=await n.from("connected_accounts").delete().eq("id",e);if(d)return c.NextResponse.json({error:"Failed to disconnect account"},{status:500});return c.NextResponse.json({message:"Account disconnected successfully",status:200},{status:200})}catch(e){return console.error("DELETE /api/connections/[id] error:",e),c.NextResponse.json({error:"Internal server error"},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/connections/[id]/route",pathname:"/api/connections/[id]",filename:"route",bundlePath:"app/api/connections/[id]/route"},resolvedPagePath:"/Users/tezferguson/gitProjects/onitsocial/src/app/api/connections/[id]/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:l,staticGenerationAsyncStorage:f,serverHooks:E}=p,h="/api/connections/[id]/route";function m(){return(0,a.patchFetch)({serverHooks:E,staticGenerationAsyncStorage:f})}},8656:(e,t,n)=>{n.d(t,{AM:()=>u,ED:()=>c,HH:()=>m,_U:()=>h,bP:()=>d,fR:()=>f,he:()=>i,mb:()=>E,qb:()=>l,tm:()=>p});let r=process.env.LATE_API_BASE_URL||"https://api.getlate.dev/v1",s=process.env.LATE_API_KEY||"";class o extends Error{constructor(e,t,n){super(t),this.statusCode=e,this.responseBody=n,this.name="LateApiError"}}async function a(e,t={}){let{method:n="GET",body:a,params:c}=t,i=`${r}${e}`;if(c){let e=new URLSearchParams(c);i+=`?${e.toString()}`}let u={Authorization:`Bearer ${s}`,"Content-Type":"application/json"},d=await fetch(i,{method:n,headers:u,body:a?JSON.stringify(a):void 0});if(!d.ok){let e=await d.json().catch(()=>null);throw new o(d.status,`Late API error: ${d.status} ${d.statusText}`,e)}if(204!==d.status)return d.json()}async function c(e){return a("/profiles",{method:"POST",body:{name:e}})}async function i(e){return a(`/profiles/${e}`,{method:"DELETE"})}async function u(e,t,n){return a(`/connect/${e}`,{params:{profileId:t,callbackUrl:n}})}async function d(e){return a("/accounts",{params:{profileId:e}})}async function p(e){return a(`/accounts/${e}`,{method:"DELETE"})}async function l(e){return a("/posts",{method:"POST",body:e})}async function f(e){return a(`/posts/${e}`,{method:"DELETE"})}async function E(e,t,n){return a(`/analytics/${e}`,{params:{startDate:t,endDate:n}})}async function h(e,t){let n={profileId:e};return t&&(n.cursor=t),a("/messages",{params:n})}async function m(e,t){return a(`/messages/${e}/reply`,{method:"POST",body:{text:t}})}},5655:(e,t,n)=>{n.d(t,{f:()=>o,k:()=>a});var r=n(7721),s=n(1615);async function o(){let e=await (0,s.cookies)();return(0,r.createServerClient)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,{cookies:{get:t=>e.get(t)?.value,set(t,n,r){try{e.set({name:t,value:n,...r})}catch{}},remove(t,n){try{e.set({name:t,value:"",...n})}catch{}}}})}async function a(){let{createClient:e}=await Promise.resolve().then(n.bind(n,7857));return e(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[9276,9702,5972],()=>n(6182));module.exports=r})();