"use strict";(()=>{var e={};e.id=2112,e.ids=[2112],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4819:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>_,patchFetch:()=>g,requestAsyncStorage:()=>m,routeModule:()=>f,serverHooks:()=>b,staticGenerationAsyncStorage:()=>h});var n={};r.r(n),r.d(n,{GET:()=>d,POST:()=>p});var s=r(9303),a=r(8716),o=r(670),i=r(7070),c=r(5655),u=r(8656),l=r(7108);async function d(e){try{let e=await (0,c.f)(),{data:{user:t},error:r}=await e.auth.getUser();if(r||!t)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{data:n,error:s}=await e.from("users").select("subscription_plan").eq("id",t.id).single();if(s)return i.NextResponse.json({error:"Failed to fetch user"},{status:500});let{data:a,error:o}=await e.from("brands").select(`
        id,
        name,
        color,
        logo_url,
        late_profile_id,
        created_at,
        connected_accounts (
          id
        )
      `).eq("user_id",t.id).order("created_at",{ascending:!1});if(o)return i.NextResponse.json({error:"Failed to fetch brands"},{status:500});let u=a.map(e=>({...e,connected_accounts_count:e.connected_accounts?.length||0,connected_accounts:void 0}));return i.NextResponse.json({data:u,plan:n.subscription_plan,limit:l.an[n.subscription_plan],used:a.length,status:200})}catch(e){return console.error("GET /api/brands error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function p(e){try{let t=await (0,c.f)(),{data:{user:r},error:n}=await t.auth.getUser();if(n||!r)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{name:s,color:a}=await e.json();if(!s||"string"!=typeof s||0===s.trim().length)return i.NextResponse.json({error:"Brand name is required"},{status:400});let{data:o,error:d}=await t.from("users").select("subscription_plan").eq("id",r.id).single();if(d)return i.NextResponse.json({error:"Failed to fetch user"},{status:500});let{data:p,error:f}=await t.from("brands").select("id",{count:"exact",head:!0}).eq("user_id",r.id);if(f)return i.NextResponse.json({error:"Failed to check brand limit"},{status:500});let m=o.subscription_plan,h=l.an[m];if((p?.length||0)>=h)return i.NextResponse.json({error:`You have reached the brand limit for your plan (${h} brands)`},{status:409});let b=null;try{b=(await (0,u.ED)(s)).id}catch(e){console.error("Failed to create Late profile:",e)}let{data:_,error:g}=await t.from("brands").insert({user_id:r.id,name:s.trim(),color:a||"#3b82f6",late_profile_id:b}).select().single();if(g)return i.NextResponse.json({error:"Failed to create brand"},{status:500});return i.NextResponse.json({data:_,status:201},{status:201})}catch(e){return console.error("POST /api/brands error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}let f=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/brands/route",pathname:"/api/brands",filename:"route",bundlePath:"app/api/brands/route"},resolvedPagePath:"/Users/tezferguson/gitProjects/onitsocial/src/app/api/brands/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:b}=f,_="/api/brands/route";function g(){return(0,o.patchFetch)({serverHooks:b,staticGenerationAsyncStorage:h})}},8656:(e,t,r)=>{r.d(t,{AM:()=>u,ED:()=>i,HH:()=>b,_U:()=>h,bP:()=>l,fR:()=>f,he:()=>c,mb:()=>m,qb:()=>p,tm:()=>d});let n=process.env.LATE_API_BASE_URL||"https://getlate.dev/api/v1",s=process.env.LATE_API_KEY||"";class a extends Error{constructor(e,t,r){super(t),this.statusCode=e,this.responseBody=r,this.name="LateApiError"}}async function o(e,t={}){let{method:r="GET",body:o,params:i}=t,c=`${n}${e}`;if(i){let e=new URLSearchParams(i);c+=`?${e.toString()}`}let u={Authorization:`Bearer ${s}`,"Content-Type":"application/json"},l=await fetch(c,{method:r,headers:u,body:o?JSON.stringify(o):void 0});if(!l.ok){let e=await l.json().catch(()=>null);throw new a(l.status,`Late API error: ${l.status} ${l.statusText}`,e)}if(204!==l.status)return l.json()}async function i(e){let t=await o("/profiles",{method:"POST",body:{name:e}});return{id:t.profile._id,name:t.profile.name}}async function c(e){return o(`/profiles/${e}`,{method:"DELETE"})}async function u(e,t,r){let n=await o(`/connect/${e}`,{params:{profileId:t,redirect_url:r,headless:"true"}}),s=n.url||n.connectUrl||n.authUrl;if(!s)throw console.error("Unexpected getLate connect response:",n),Error("No connect URL in response");return{url:s}}async function l(e){let t=await o("/accounts",{params:{profileId:e}});return t.accounts?{data:t.accounts.map(e=>({id:e._id||e.id,platform:e.platform,username:e.username||e.name||"",avatarUrl:e.avatarUrl||""}))}:{data:t.data||[]}}async function d(e){return o(`/accounts/${e}`,{method:"DELETE"})}async function p(e){return o("/posts",{method:"POST",body:e})}async function f(e){return o(`/posts/${e}`,{method:"DELETE"})}async function m(e,t,r){return o(`/analytics/${e}`,{params:{startDate:t,endDate:r}})}async function h(e,t){let r={profileId:e};return t&&(r.cursor=t),o("/messages",{params:r})}async function b(e,t){return o(`/messages/${e}/reply`,{method:"POST",body:{text:t}})}},5655:(e,t,r)=>{r.d(t,{f:()=>a,k:()=>o});var n=r(7721),s=r(1615);async function a(){let e=await (0,s.cookies)();return(0,n.createServerClient)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,{cookies:{get:t=>e.get(t)?.value,set(t,r,n){try{e.set({name:t,value:r,...n})}catch{}},remove(t,r){try{e.set({name:t,value:"",...r})}catch{}}}})}async function o(){let{createClient:e}=await Promise.resolve().then(r.bind(r,7857));return e(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})}},7108:(e,t,r)=>{r.d(t,{VT:()=>s,an:()=>n});let n={solo:1,starter:5,advanced:10},s=[{id:"facebook",label:"Facebook",color:"#1877F2",icon:"Facebook"},{id:"instagram",label:"Instagram",color:"#E4405F",icon:"Instagram"},{id:"tiktok",label:"TikTok",color:"#000000",icon:"Music"},{id:"youtube",label:"YouTube",color:"#FF0000",icon:"Youtube"},{id:"linkedin",label:"LinkedIn",color:"#0A66C2",icon:"Linkedin"},{id:"google_business",label:"Google Business",color:"#4285F4",icon:"MapPin"}]}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[9276,9702,5972],()=>r(4819));module.exports=n})();