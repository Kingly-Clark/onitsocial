"use strict";(()=>{var e={};e.id=7558,e.ids=[7558],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},20266:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>h,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>f});var s={};r.r(s),r.d(s,{POST:()=>d});var n=r(49303),a=r(88716),o=r(60670),i=r(87070),c=r(65655),u=r(8656);async function d(e,{params:t}){try{let e;let{id:r}=await t,s=await (0,c.f)(),{data:{user:n},error:a}=await s.auth.getUser();if(a||!n)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{data:o,error:d}=await s.from("brands").select("id, name, late_profile_id").eq("id",r).eq("user_id",n.id).single();if(d||!o)return i.NextResponse.json({error:"Brand not found"},{status:404});if(o.late_profile_id)return i.NextResponse.json({data:{late_profile_id:o.late_profile_id,already_synced:!0},message:"Brand is already synced with platform",status:200});if(!process.env.LATE_API_KEY)return i.NextResponse.json({error:"LATE_API_KEY environment variable is not configured in Vercel."},{status:500});try{e=(await (0,u.ED)(o.name)).id}catch(t){console.error("Failed to create Late profile:",t);let e="Failed to sync with platform.";if(t&&"object"==typeof t){if("statusCode"in t){let r=t.statusCode,s=t.responseBody;console.error("Late API response body:",JSON.stringify(s,null,2)),e=401===r?"Invalid API key. Please check your LATE_API_KEY in Vercel.":403===r?"API key doesn't have permission. Check your getLate account.":404===r?"API endpoint not found. The getLate API may have changed.":s&&"object"==typeof s?`Platform error (${r}): ${s.message||s.error||JSON.stringify(s)}`:`Platform error (${r})`}else"message"in t&&(e=`Error: ${t.message}`)}else t instanceof Error&&(e=`Error: ${t.message}`);return i.NextResponse.json({error:e},{status:500})}let l=await (0,c.k)(),{error:p}=await l.from("brands").update({late_profile_id:e}).eq("id",r).eq("user_id",n.id);if(p)return console.error("Supabase update error:",p),i.NextResponse.json({error:`Failed to update brand: ${p.message} (${p.code})`},{status:500});let{data:f}=await l.from("brands").select("*").eq("id",r).single();return i.NextResponse.json({data:f||{id:r,late_profile_id:e},message:"Brand synced successfully",status:200})}catch(e){return console.error("POST /api/brands/[id]/sync error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}let l=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/brands/[id]/sync/route",pathname:"/api/brands/[id]/sync",filename:"route",bundlePath:"app/api/brands/[id]/sync/route"},resolvedPagePath:"/Users/tezferguson/gitProjects/onitsocial/src/app/api/brands/[id]/sync/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:p,staticGenerationAsyncStorage:f,serverHooks:m}=l,y="/api/brands/[id]/sync/route";function h(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:f})}},8656:(e,t,r)=>{r.d(t,{AM:()=>u,ED:()=>i,HH:()=>h,_U:()=>y,bP:()=>d,fR:()=>f,he:()=>c,mb:()=>m,qb:()=>p,tm:()=>l});let s=process.env.LATE_API_BASE_URL||"https://getlate.dev/api/v1",n=process.env.LATE_API_KEY||"";class a extends Error{constructor(e,t,r){super(t),this.statusCode=e,this.responseBody=r,this.name="LateApiError"}}async function o(e,t={}){let{method:r="GET",body:o,params:i}=t,c=`${s}${e}`;if(i){let e=new URLSearchParams(i);c+=`?${e.toString()}`}let u={Authorization:`Bearer ${n}`,"Content-Type":"application/json"},d=await fetch(c,{method:r,headers:u,body:o?JSON.stringify(o):void 0});if(!d.ok){let e=await d.json().catch(()=>null);throw new a(d.status,`Late API error: ${d.status} ${d.statusText}`,e)}if(204!==d.status)return d.json()}async function i(e){let t=await o("/profiles",{method:"POST",body:{name:e}});return{id:t.profile._id,name:t.profile.name}}async function c(e){return o(`/profiles/${e}`,{method:"DELETE"})}async function u(e,t,r){let s=await o(`/connect/${e}`,{params:{profileId:t,redirect_url:r,headless:"true"}}),n=s.url||s.connectUrl||s.authUrl;if(!n)throw console.error("Unexpected getLate connect response:",s),Error("No connect URL in response");return{url:n}}async function d(e){let t=await o("/accounts",{params:{profileId:e}});return t.accounts?{data:t.accounts.map(e=>({id:e._id||e.id,platform:e.platform,username:e.username||e.name||"",avatarUrl:e.avatarUrl||""}))}:{data:t.data||[]}}async function l(e){return o(`/accounts/${e}`,{method:"DELETE"})}async function p(e){return o("/posts",{method:"POST",body:e})}async function f(e){return o(`/posts/${e}`,{method:"DELETE"})}async function m(e,t,r){return o(`/analytics/${e}`,{params:{startDate:t,endDate:r}})}async function y(e,t){let r={profileId:e};return t&&(r.cursor=t),o("/messages",{params:r})}async function h(e,t){return o(`/messages/${e}/reply`,{method:"POST",body:{text:t}})}},65655:(e,t,r)=>{r.d(t,{f:()=>a,k:()=>o});var s=r(67721),n=r(71615);async function a(){let e=await (0,n.cookies)();return(0,s.createServerClient)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,{cookies:{get:t=>e.get(t)?.value,set(t,r,s){try{e.set({name:t,value:r,...s})}catch{}},remove(t,r){try{e.set({name:t,value:"",...r})}catch{}}}})}async function o(){let{createClient:e}=await Promise.resolve().then(r.bind(r,37857));return e(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[9276,9702,5972],()=>r(20266));module.exports=s})();