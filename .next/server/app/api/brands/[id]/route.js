"use strict";(()=>{var e={};e.id=5678,e.ids=[5678],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9951:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>E,patchFetch:()=>y,requestAsyncStorage:()=>m,routeModule:()=>f,serverHooks:()=>h,staticGenerationAsyncStorage:()=>_});var s={};r.r(s),r.d(s,{DELETE:()=>p,GET:()=>c,PATCH:()=>l});var a=r(9303),n=r(8716),o=r(670),i=r(7070),u=r(5655),d=r(8656);async function c(e,{params:t}){try{let{id:e}=await t,r=await (0,u.f)(),{data:{user:s},error:a}=await r.auth.getUser();if(a||!s)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{data:n,error:o}=await r.from("brands").select(`
        id,
        name,
        color,
        logo_url,
        late_profile_id,
        created_at,
        connected_accounts (
          id,
          brand_id,
          platform,
          late_account_id,
          platform_username,
          platform_avatar,
          connected_at,
          status
        )
      `).eq("id",e).eq("user_id",s.id).single();if(o||!n)return i.NextResponse.json({error:"Brand not found"},{status:404});return i.NextResponse.json({data:n,status:200})}catch(e){return console.error("GET /api/brands/[id] error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function l(e,{params:t}){try{let{id:r}=await t,s=await (0,u.f)(),{data:{user:a},error:n}=await s.auth.getUser();if(n||!a)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{data:o,error:d}=await s.from("brands").select("id").eq("id",r).eq("user_id",a.id).single();if(d||!o)return i.NextResponse.json({error:"Brand not found"},{status:404});let{name:c,color:l,logo_url:p}=await e.json(),f={};void 0!==c&&(f.name=c),void 0!==l&&(f.color=l),void 0!==p&&(f.logo_url=p);let{data:m,error:_}=await s.from("brands").update(f).eq("id",r).select().single();if(_)return i.NextResponse.json({error:"Failed to update brand"},{status:500});return i.NextResponse.json({data:m,status:200})}catch(e){return console.error("PATCH /api/brands/[id] error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function p(e,{params:t}){try{let{id:e}=await t,r=await (0,u.f)(),{data:{user:s},error:a}=await r.auth.getUser();if(a||!s)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{data:n,error:o}=await r.from("brands").select("id, late_profile_id").eq("id",e).eq("user_id",s.id).single();if(o||!n)return i.NextResponse.json({error:"Brand not found"},{status:404});if(n.late_profile_id)try{await (0,d.he)(n.late_profile_id)}catch(e){console.error("Failed to delete Late profile:",e)}let{error:c}=await r.from("brands").delete().eq("id",e);if(c)return i.NextResponse.json({error:"Failed to delete brand"},{status:500});return i.NextResponse.json({message:"Brand deleted successfully",status:200},{status:200})}catch(e){return console.error("DELETE /api/brands/[id] error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}let f=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/brands/[id]/route",pathname:"/api/brands/[id]",filename:"route",bundlePath:"app/api/brands/[id]/route"},resolvedPagePath:"/Users/tezferguson/gitProjects/onitsocial/src/app/api/brands/[id]/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:_,serverHooks:h}=f,E="/api/brands/[id]/route";function y(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:_})}},8656:(e,t,r)=>{r.d(t,{AM:()=>d,ED:()=>i,HH:()=>h,_U:()=>_,bP:()=>c,fR:()=>f,he:()=>u,mb:()=>m,qb:()=>p,tm:()=>l});let s=process.env.LATE_API_BASE_URL||"https://api.getlate.dev/v1",a=process.env.LATE_API_KEY||"";class n extends Error{constructor(e,t,r){super(t),this.statusCode=e,this.responseBody=r,this.name="LateApiError"}}async function o(e,t={}){let{method:r="GET",body:o,params:i}=t,u=`${s}${e}`;if(i){let e=new URLSearchParams(i);u+=`?${e.toString()}`}let d={Authorization:`Bearer ${a}`,"Content-Type":"application/json"},c=await fetch(u,{method:r,headers:d,body:o?JSON.stringify(o):void 0});if(!c.ok){let e=await c.json().catch(()=>null);throw new n(c.status,`Late API error: ${c.status} ${c.statusText}`,e)}if(204!==c.status)return c.json()}async function i(e){return o("/profiles",{method:"POST",body:{name:e}})}async function u(e){return o(`/profiles/${e}`,{method:"DELETE"})}async function d(e,t,r){return o(`/connect/${e}`,{params:{profileId:t,callbackUrl:r}})}async function c(e){return o("/accounts",{params:{profileId:e}})}async function l(e){return o(`/accounts/${e}`,{method:"DELETE"})}async function p(e){return o("/posts",{method:"POST",body:e})}async function f(e){return o(`/posts/${e}`,{method:"DELETE"})}async function m(e,t,r){return o(`/analytics/${e}`,{params:{startDate:t,endDate:r}})}async function _(e,t){let r={profileId:e};return t&&(r.cursor=t),o("/messages",{params:r})}async function h(e,t){return o(`/messages/${e}/reply`,{method:"POST",body:{text:t}})}},5655:(e,t,r)=>{r.d(t,{f:()=>n,k:()=>o});var s=r(7721),a=r(1615);async function n(){let e=await (0,a.cookies)();return(0,s.createServerClient)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,{cookies:{get:t=>e.get(t)?.value,set(t,r,s){try{e.set({name:t,value:r,...s})}catch{}},remove(t,r){try{e.set({name:t,value:"",...r})}catch{}}}})}async function o(){let{createClient:e}=await Promise.resolve().then(r.bind(r,7857));return e(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[9276,9702,5972],()=>r(9951));module.exports=s})();